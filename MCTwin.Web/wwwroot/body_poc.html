<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Body POC - Infographic Style</title>
    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', sans-serif;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 300px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-weight: bold;
            font-size: 14px;
            color: #333;
        }

        button {
            padding: 8px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        button:hover {
            background: #0056b3;
        }

        select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
    </style>
    <!-- Babylon.js CDN -->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
</head>

<body>
    <canvas id="renderCanvas"></canvas>

    <div id="controls">
        <h3>Body POC: Infographic Style</h3>
        <p>Full Character Assembly</p>

        <div class="control-group">
            <label>Clothing Color</label>
            <input type="color" id="clothesColor" value="#336699">
        </div>

        <div class="control-group">
            <label>Pants Color</label>
            <input type="color" id="pantsColor" value="#222222">
        </div>

        <button onclick="setSecretary()">Preset: Secretary</button>
        <button onclick="randomize()">Randomize Colors</button>
    </div>

    <script>
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);

        // --- GLOBAL CONFIG ---
        let currentConfig = {
            skinColor: "#ffdbac",
            hairColor: "#cc3300",
            hairStyle: "bangs",
            eyeStyle: "oval",
            mouthStyle: "smirk",
            hasGlasses: true,
            hasBlush: true,

            clothesColor: "#ffffff",
            pantsColor: "#333333"
        };

        // --- MESH REFS ---
        let faceTexture, hairOpacityTexture;
        let headMaterial, hairMaterial, clothesMaterial, pantsMaterial, skinMaterial;
        let headGroup, hairShell, hairBun;

        const createScene = function () {
            const scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color4(0.9, 0.9, 0.95, 1);

            // Camera
            const camera = new BABYLON.ArcRotateCamera("camera", Math.PI / 2, Math.PI / 2.5, 8, new BABYLON.Vector3(0, 1, 0), scene);
            camera.attachControl(canvas, true);
            camera.wheelPrecision = 50;
            camera.minZ = 0.1;

            // Lights
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
            light.intensity = 0.7;
            const dirLight = new BABYLON.DirectionalLight("dirLight", new BABYLON.Vector3(-0.5, -0.5, -1), scene);
            dirLight.position = new BABYLON.Vector3(5, 5, 5);
            dirLight.intensity = 0.6;

            // Shadows
            const shadowGenerator = new BABYLON.ShadowGenerator(1024, dirLight);
            shadowGenerator.useBlurExponentialShadowMap = true;

            // Ground
            const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 10, height: 10 }, scene);
            ground.receiveShadows = true;
            const groundMat = new BABYLON.StandardMaterial("gMat", scene);
            groundMat.diffuseColor = new BABYLON.Color3(0.8, 0.8, 0.8);
            ground.material = groundMat;


            // --- MATERIALS ---
            headMaterial = new BABYLON.StandardMaterial("headMat", scene);
            headMaterial.specularColor = new BABYLON.Color3(0.05, 0.05, 0.05);

            hairMaterial = new BABYLON.StandardMaterial("hairMat", scene);
            hairMaterial.specularColor = new BABYLON.Color3(0.2, 0.2, 0.2);
            hairMaterial.transparencyMode = BABYLON.Material.MATERIAL_ALPHATEST;
            hairMaterial.backFaceCulling = false;

            skinMaterial = new BABYLON.StandardMaterial("skinMat", scene);
            skinMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.skinColor);
            skinMaterial.specularColor = new BABYLON.Color3(0.05, 0.05, 0.05);

            clothesMaterial = new BABYLON.StandardMaterial("clothMat", scene);
            clothesMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.clothesColor);

            pantsMaterial = new BABYLON.StandardMaterial("pantsMat", scene);
            pantsMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.pantsColor);


            // --- CHARACTER ROOT ---
            const root = new BABYLON.TransformNode("root", scene);


            // --- 1. HEAD (Ellipsoid) ---
            // Reduced diameter (1.8 -> 1.5) and raised Y (3.6 -> 4.0) to reveal neck
            // Reduced diameter (1.8 -> 1.5) and raised Y (3.6 -> 3.8) to sit "in" the shoulders
            const headMesh = BABYLON.MeshBuilder.CreateSphere("head", { diameter: 1.5, segments: 32 }, scene);
            headMesh.scaling = new BABYLON.Vector3(1, 1.25, 1);
            headMesh.position.y = 3.8;
            headMesh.rotation.y = Math.PI / 2; // Face forward
            headMesh.parent = root;
            headMesh.material = headMaterial;
            shadowGenerator.addShadowCaster(headMesh);

            // Face Tex
            faceTexture = new BABYLON.DynamicTexture("faceTex", 1024, scene, true);
            faceTexture.wAng = Math.PI;
            headMaterial.diffuseTexture = faceTexture;

            // Hair Shell
            hairShell = BABYLON.MeshBuilder.CreateSphere("hairShell", { diameter: 1.5, segments: 32 }, scene);
            hairShell.parent = headMesh;
            hairShell.scaling = new BABYLON.Vector3(1.05, 1.05, 1.06);
            hairShell.material = hairMaterial;
            shadowGenerator.addShadowCaster(hairShell);

            hairOpacityTexture = new BABYLON.DynamicTexture("hairOpacity", 1024, scene, true);
            hairOpacityTexture.wAng = Math.PI; // Correct orientation
            hairMaterial.opacityTexture = hairOpacityTexture;

            // Hair Bun
            hairBun = BABYLON.MeshBuilder.CreateSphere("bun", { diameter: 0.7, segments: 16 }, scene);
            hairBun.parent = headMesh;
            hairBun.position.z = -0.65; // Adjusted for smaller head
            hairBun.position.y = 0.3;
            hairBun.scaling = new BABYLON.Vector3(0.8, 0.64, 0.5);
            hairBun.material = hairMaterial;
            shadowGenerator.addShadowCaster(hairBun);


            // --- 2. TORSO (Rounded Box / Soft Block) ---
            // Using a Box scaled to look like a thick torso
            const torso = BABYLON.MeshBuilder.CreateBox("torso", { width: 1.2, height: 1.6, depth: 0.6 }, scene);
            torso.position.y = 2.4; // Below head
            torso.parent = root;
            torso.material = clothesMaterial;
            shadowGenerator.addShadowCaster(torso);

            // Neck connection (cylinder) - Thicker and shorter
            const neck = BABYLON.MeshBuilder.CreateCylinder("neck", { diameter: 0.6, height: 0.4 }, scene);
            neck.position.y = 3.25;
            neck.parent = root;
            neck.material = skinMaterial;


            // --- 3. ARMS (Capsules) ---
            const armL = BABYLON.MeshBuilder.CreateCapsule("armL", { radius: 0.25, height: 1.8 }, scene);
            armL.position.set(-0.9, 2.4, 0);
            armL.parent = root;
            armL.material = clothesMaterial; // Long sleeves
            shadowGenerator.addShadowCaster(armL);

            const armR = BABYLON.MeshBuilder.CreateCapsule("armR", { radius: 0.25, height: 1.8 }, scene);
            armR.position.set(0.9, 2.4, 0);
            armR.parent = root;
            armR.material = clothesMaterial;
            shadowGenerator.addShadowCaster(armR);


            // --- 4. HANDS (Mitten/Spheres) ---
            const handL = BABYLON.MeshBuilder.CreateSphere("handL", { diameter: 0.45 }, scene);
            handL.position.y = -0.8; // Relative to Arm
            handL.scaling.y = 1.2;
            handL.parent = armL;
            handL.material = skinMaterial;

            const handR = BABYLON.MeshBuilder.CreateSphere("handR", { diameter: 0.45 }, scene);
            handR.position.y = -0.8;
            handR.scaling.y = 1.2;
            handR.parent = armR;
            handR.material = skinMaterial;


            // --- 5. LEGS (Capsules) ---
            const legL = BABYLON.MeshBuilder.CreateCapsule("legL", { radius: 0.28, height: 1.8 }, scene);
            legL.position.set(-0.4, 0.9, 0);
            legL.parent = root;
            legL.material = pantsMaterial;
            shadowGenerator.addShadowCaster(legL);

            const legR = BABYLON.MeshBuilder.CreateCapsule("legR", { radius: 0.28, height: 1.8 }, scene);
            legR.position.set(0.4, 0.9, 0);
            legR.parent = root;
            legR.material = pantsMaterial;
            shadowGenerator.addShadowCaster(legR);


            // --- 6. FEET (Hemispheres) ---
            const footL = BABYLON.MeshBuilder.CreateSphere("footL", { diameter: 0.7, slice: 0.5 }, scene);
            footL.position.y = -0.9;
            footL.position.z = 0.2; // Stick out forward
            footL.parent = legL;
            footL.material = pantsMaterial; // Shoes match pants for now

            const footR = BABYLON.MeshBuilder.CreateSphere("footR", { diameter: 0.7, slice: 0.5 }, scene);
            footR.position.y = -0.9;
            footR.position.z = 0.2;
            footR.parent = legR;
            footR.material = pantsMaterial;


            // Initial Draw
            updateFace();
            updateHair();
            updateColors();

            return scene;
        };

        // --- DRAWING LOGIC (Copied from Shell POC) ---
        function updateFace() {
            if (!faceTexture) return;
            const ctx = faceTexture.getContext();
            const w = 1024; const h = 1024;

            ctx.fillStyle = currentConfig.skinColor;
            ctx.fillRect(0, 0, w, h);
            headMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.skinColor);
            skinMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.skinColor);

            const centerX = w / 2;
            const eyeY = h * 0.45;
            const mouthY = h * 0.58;
            const eyeOffset = w * 0.12;

            // Simple Face Logic
            ctx.fillStyle = "rgba(200, 50, 50, 0.15)";
            ctx.beginPath();
            ctx.arc(centerX - eyeOffset - 20, eyeY + 60, 45, 0, Math.PI * 2);
            ctx.arc(centerX + eyeOffset + 20, eyeY + 60, 45, 0, Math.PI * 2);
            ctx.fill();

            // Eyes & Glasses
            ctx.fillStyle = "#222";
            ctx.strokeStyle = "#222";
            ctx.lineWidth = 15;

            // Ovals
            ctx.beginPath();
            ctx.ellipse(centerX - eyeOffset, eyeY, 25, 45, 0, 0, Math.PI * 2);
            ctx.ellipse(centerX + eyeOffset, eyeY, 25, 45, 0, 0, Math.PI * 2);
            ctx.fill();

            if (currentConfig.hasGlasses) {
                ctx.fillStyle = "rgba(200, 240, 255, 0.4)";
                ctx.strokeStyle = "#111";
                ctx.lineWidth = 8;
                let gx = 55; let gy = 40;
                ctx.beginPath();
                ctx.roundRect(centerX - eyeOffset - gx / 2 - 10, eyeY - gy / 2, gx + 20, gy + 10, 20);
                ctx.fill(); ctx.stroke();
                ctx.beginPath();
                ctx.roundRect(centerX + eyeOffset - gx / 2 - 10, eyeY - gy / 2, gx + 20, gy + 10, 20);
                ctx.fill(); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(centerX - eyeOffset + 25, eyeY); ctx.lineTo(centerX + eyeOffset - 25, eyeY); ctx.stroke();
            }

            // Mouth
            ctx.strokeStyle = "#333";
            ctx.lineWidth = 12;
            ctx.beginPath();
            ctx.moveTo(centerX - 30, mouthY);
            ctx.quadraticCurveTo(centerX + 10, mouthY + 15, centerX + 40, mouthY - 10);
            ctx.stroke();

            faceTexture.update();
        }

        function updateHair() {
            if (!hairOpacityTexture) return;
            const ctx = hairOpacityTexture.getContext();
            const w = 1024; const h = 1024;
            const centerX = w / 2;

            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, w, h);
            ctx.globalCompositeOperation = "destination-out";
            ctx.fillStyle = "black";

            // Bangs Cutout
            ctx.beginPath();
            ctx.moveTo(centerX, h * 0.35);
            ctx.bezierCurveTo(w * 0.3, h * 0.32, w * 0.2, h * 0.4, w * 0.2, h * 0.6);
            ctx.lineTo(w * 0.2, h); ctx.lineTo(w * 0.8, h);
            ctx.lineTo(w * 0.8, h * 0.6);
            ctx.bezierCurveTo(w * 0.8, h * 0.4, w * 0.7, h * 0.32, centerX, h * 0.35);
            ctx.fill();

            hairMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.hairColor);
            ctx.globalCompositeOperation = "source-over";
            hairOpacityTexture.update();

            if (hairBun) hairBun.isVisible = true;
        }

        function updateColors() {
            clothesMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.clothesColor);
            pantsMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.pantsColor);
        }

        // --- UI BINDINGS ---
        document.getElementById("clothesColor").addEventListener("input", (e) => { currentConfig.clothesColor = e.target.value; updateColors(); });
        document.getElementById("pantsColor").addEventListener("input", (e) => { currentConfig.pantsColor = e.target.value; updateColors(); });

        function setSecretary() {
            currentConfig.hairStyle = "bangs";
            currentConfig.hairColor = "#cc3300";
            currentConfig.skinColor = "#ffdbac";
            currentConfig.clothesColor = "#ffffff"; // White Shirt
            currentConfig.pantsColor = "#222222";   // Black Skirt/Pants

            document.getElementById("clothesColor").value = currentConfig.clothesColor;
            document.getElementById("pantsColor").value = currentConfig.pantsColor;

            updateFace(); updateHair(); updateColors();
        }

        function randomize() {
            const clothes = ["#336699", "#993333", "#339933", "#ffffff", "#333333"];
            const pants = ["#111111", "#444444", "#223344", "#663322"];
            currentConfig.clothesColor = clothes[Math.floor(Math.random() * clothes.length)];
            currentConfig.pantsColor = pants[Math.floor(Math.random() * pants.length)];

            document.getElementById("clothesColor").value = currentConfig.clothesColor;
            document.getElementById("pantsColor").value = currentConfig.pantsColor;

            updateColors();
        }

        const scene = createScene();
        engine.runRenderLoop(() => scene.render());
        window.addEventListener("resize", () => engine.resize());

    </script>
</body>

</html>