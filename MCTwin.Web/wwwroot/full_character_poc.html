<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Full Character POC - Infographic Style</title>
    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', sans-serif;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 320px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 90vh;
            overflow-y: auto;
        }

        h3 {
            margin-top: 0;
            margin-bottom: 5px;
        }

        h4 {
            margin: 10px 0 5px 0;
            font-size: 13px;
            text-transform: uppercase;
            color: #666;
            border-bottom: 1px solid #ddd;
            padding-bottom: 2px;
        }

        .control-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        label {
            font-size: 13px;
            font-weight: 600;
            color: #333;
        }

        select,
        input[type=color] {
            padding: 4px;
            border-radius: 4px;
            border: 1px solid #ccc;
            width: 140px;
        }

        button {
            padding: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        button.secondary {
            background: #6c757d;
        }

        button.secondary:hover {
            background: #5a6268;
        }
    </style>
    <!-- Babylon.js CDN -->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
</head>

<body>
    <canvas id="renderCanvas"></canvas>

    <div id="controls">
        <h3>Full Character POC</h3>
        <p>Infographic Style Assembly</p>

        <h4>Face & Hair</h4>
        <div class="control-group">
            <label>Skin Tone</label>
            <input type="color" id="skinColor" value="#ffdbac">
        </div>
        <div class="control-group">
            <label>Hair Style</label>
            <select id="hairStyle">
                <option value="none">Bald</option>
                <option value="bob">Bob Cut</option>
                <option value="sidepart">Side Part</option>
                <option value="bangs">Structured Bangs</option>
                <option value="short">Short (Male)</option>
            </select>
        </div>
        <div class="control-group">
            <label>Hair Color</label>
            <input type="color" id="hairColor" value="#cc3300">
        </div>
        <div class="control-group">
            <label>Mouth</label>
            <select id="expression">
                <option value="neutral">Neutral</option>
                <option value="happy">Happy</option>
                <option value="smirk">Smirk</option>
            </select>
        </div>
        <div class="control-group">
            <label>Eyes</label>
            <select id="eyeStyle">
                <option value="oval">Ovals</option>
                <option value="dot">Dots</option>
            </select>
        </div>
        <div class="control-group">
            <label>Glasses</label>
            <input type="checkbox" id="hasGlasses" checked>
        </div>

        <h4>Outfit</h4>
        <div class="control-group">
            <label>Shirt Color</label>
            <input type="color" id="clothesColor" value="#ffffff">
        </div>
        <div class="control-group">
            <label>Pants Color</label>
            <input type="color" id="pantsColor" value="#222222">
        </div>

        <div class="control-group">
            <label>Actions</label>
        </div>
        <button onclick="setSecretary()">Preset: Secretary</button>
        <button onclick="setExecutive()">Preset: Executive</button>
        <button onclick="setConstruction()">Preset: Construction</button>
        <button onclick="setAthlete()">Preset: Athlete</button>
        <button class="secondary" onclick="randomize()">Randomize All</button>
    </div>

    <script>
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);

        // --- GLOBAL CONFIG ---
        let currentConfig = {
            skinColor: "#ffdbac",
            hairColor: "#cc3300",
            hairStyle: "bangs",
            eyeStyle: "oval",
            mouthStyle: "smirk",
            hasGlasses: true,
            hasBlush: true,

            clothesColor: "#ffffff",
            pantsColor: "#222222"
        };

        // --- MESH REFS ---
        let faceTexture, hairOpacityTexture;
        let headMaterial, hairMaterial, clothesMaterial, pantsMaterial, skinMaterial;
        let headGroup, hairShell, hairBun;
        let skirtMesh, legL, legR; // For visibility toggles

        const createScene = function () {
            const scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color4(0.9, 0.9, 0.95, 1);

            // Camera
            const camera = new BABYLON.ArcRotateCamera("camera", Math.PI / 2, Math.PI / 2.5, 8, new BABYLON.Vector3(0, 1, 0), scene);
            camera.attachControl(canvas, true);
            camera.wheelPrecision = 50;
            camera.minZ = 0.1;

            // Lights
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
            light.intensity = 0.7;
            const dirLight = new BABYLON.DirectionalLight("dirLight", new BABYLON.Vector3(-0.5, -0.5, -1), scene);
            dirLight.position = new BABYLON.Vector3(5, 5, 5);
            dirLight.intensity = 0.6;

            // Shadows
            const shadowGenerator = new BABYLON.ShadowGenerator(1024, dirLight);
            shadowGenerator.useBlurExponentialShadowMap = true;

            // Ground
            const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 10, height: 10 }, scene);
            ground.receiveShadows = true;
            const groundMat = new BABYLON.StandardMaterial("gMat", scene);
            groundMat.diffuseColor = new BABYLON.Color3(0.8, 0.8, 0.8);
            ground.material = groundMat;


            // --- MATERIALS ---
            headMaterial = new BABYLON.StandardMaterial("headMat", scene);
            headMaterial.specularColor = new BABYLON.Color3(0.05, 0.05, 0.05);

            hairMaterial = new BABYLON.StandardMaterial("hairMat", scene);
            hairMaterial.specularColor = new BABYLON.Color3(0.2, 0.2, 0.2);
            hairMaterial.transparencyMode = BABYLON.Material.MATERIAL_ALPHATEST;
            hairMaterial.backFaceCulling = false;

            skinMaterial = new BABYLON.StandardMaterial("skinMat", scene);
            skinMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.skinColor);
            skinMaterial.specularColor = new BABYLON.Color3(0.05, 0.05, 0.05);

            clothesMaterial = new BABYLON.StandardMaterial("clothMat", scene);
            clothesMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.clothesColor);

            pantsMaterial = new BABYLON.StandardMaterial("pantsMat", scene);
            pantsMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.pantsColor);


            // --- CHARACTER ROOT ---
            const root = new BABYLON.TransformNode("root", scene);


            // --- 1. HEAD (Ellipsoid) ---
            const headMesh = BABYLON.MeshBuilder.CreateSphere("head", { diameter: 1.5, segments: 32 }, scene);
            headMesh.scaling = new BABYLON.Vector3(1, 1.25, 1);
            headMesh.position.y = 3.8;
            headMesh.rotation.y = Math.PI / 2; // Face forward
            headMesh.parent = root;
            headMesh.material = headMaterial;
            shadowGenerator.addShadowCaster(headMesh);

            // Face Tex
            faceTexture = new BABYLON.DynamicTexture("faceTex", 1024, scene, true);
            faceTexture.wAng = Math.PI;
            headMaterial.diffuseTexture = faceTexture;

            // Hair Shell
            hairShell = BABYLON.MeshBuilder.CreateSphere("hairShell", { diameter: 1.5, segments: 32 }, scene);
            hairShell.parent = headMesh;
            hairShell.scaling = new BABYLON.Vector3(1.05, 1.05, 1.06);
            hairShell.material = hairMaterial;
            shadowGenerator.addShadowCaster(hairShell);

            hairOpacityTexture = new BABYLON.DynamicTexture("hairOpacity", 1024, scene, true);
            hairOpacityTexture.wAng = Math.PI; // Correct orientation
            hairMaterial.opacityTexture = hairOpacityTexture;

            // Hair Bun
            hairBun = BABYLON.MeshBuilder.CreateSphere("bun", { diameter: 0.7, segments: 16 }, scene);
            hairBun.parent = headMesh;
            hairBun.position.z = -0.65; // Adjusted for smaller head
            hairBun.position.y = 0.3;
            hairBun.scaling = new BABYLON.Vector3(0.8, 0.64, 0.5);
            hairBun.material = hairMaterial;
            shadowGenerator.addShadowCaster(hairBun);


            // --- 2. TORSO (The "Blouse" - Tapered Cylinder + Facets) ---
            const torso = BABYLON.MeshBuilder.CreateCylinder("torso", {
                diameterTop: 0.9,
                diameterBottom: 1.25,
                height: 1.6,
                tessellation: 12,
                subdivisions: 4       // Sequin Grid
            }, scene);

            torso.convertToFlatShadedMesh();
            torso.scaling.z = 0.65; // Flatten
            torso.position.y = 2.4;
            torso.material = clothesMaterial;
            torso.parent = root;
            shadowGenerator.addShadowCaster(torso);

            // --- DETAILS (Shoulders & Bust) ---
            // Shoulder Joints
            const shldrL = BABYLON.MeshBuilder.CreateSphere("shldrL", { diameter: 0.7, segments: 8 }, scene);
            shldrL.position.set(-0.55, 3.0, 0);
            shldrL.material = clothesMaterial;
            shldrL.convertToFlatShadedMesh();
            shldrL.parent = root;

            const shldrR = BABYLON.MeshBuilder.CreateSphere("shldrR", { diameter: 0.7, segments: 8 }, scene);
            shldrR.position.set(0.55, 3.0, 0);
            shldrR.material = clothesMaterial;
            shldrR.convertToFlatShadedMesh();
            shldrR.parent = root;

            // Bust
            const bust = BABYLON.MeshBuilder.CreateSphere("bust", { diameter: 1.0, segments: 12 }, scene);
            bust.scaling.z = 0.3;
            bust.scaling.y = 0.7;
            bust.position.set(0, 2.7, 0.22);
            bust.material = clothesMaterial;
            bust.convertToFlatShadedMesh();
            bust.parent = root;

            // --- 3. ARMS (Stretched Spheres) ---
            const armL = BABYLON.MeshBuilder.CreateSphere("armL", { diameter: 0.5, segments: 8 }, scene);
            armL.scaling.y = 3.6;
            armL.position.set(-0.75, 2.3, 0);
            armL.material = clothesMaterial;
            armL.convertToFlatShadedMesh();
            armL.parent = root;
            shadowGenerator.addShadowCaster(armL);

            const armR = BABYLON.MeshBuilder.CreateSphere("armR", { diameter: 0.5, segments: 8 }, scene);
            armR.scaling.y = 3.6;
            armR.position.set(0.75, 2.3, 0);
            armR.material = clothesMaterial;
            armR.convertToFlatShadedMesh();
            armR.parent = root;
            shadowGenerator.addShadowCaster(armR);

            // --- 4. HANDS (Mitten/Spheres) ---
            const handL = BABYLON.MeshBuilder.CreateSphere("handL", { diameter: 0.45 }, scene);
            handL.position.y = -0.3; // Relative to Sphere Arm (different pivot)
            handL.scaling.y = 0.3;   // Adjusted scaling for sphere parent
            handL.parent = armL;
            handL.material = skinMaterial;

            const handR = BABYLON.MeshBuilder.CreateSphere("handR", { diameter: 0.45 }, scene);
            handR.position.y = -0.3;
            handR.scaling.y = 0.3;
            handR.parent = armR;
            handR.material = skinMaterial;


            // --- 5. LEGS (Stretched Spheres) ---
            legL = BABYLON.MeshBuilder.CreateSphere("legL", { diameter: 0.56, segments: 8 }, scene);
            legL.scaling.y = 3.2;
            legL.position.set(-0.4, 0.9, 0);
            legL.material = pantsMaterial;
            legL.convertToFlatShadedMesh();
            legL.parent = root;
            shadowGenerator.addShadowCaster(legL);

            legR = BABYLON.MeshBuilder.CreateSphere("legR", { diameter: 0.56, segments: 8 }, scene);
            legR.scaling.y = 3.2;
            legR.position.set(0.4, 0.9, 0);
            legR.material = pantsMaterial;
            legR.convertToFlatShadedMesh();
            legR.parent = root;
            shadowGenerator.addShadowCaster(legR);


            // --- 6. FEET (Hemispheres) ---
            const footL = BABYLON.MeshBuilder.CreateSphere("footL", { diameter: 0.7, slice: 0.5 }, scene);
            footL.position.y = -0.3; // Relative to Sphere Leg
            footL.position.z = 0.05;
            footL.scaling.y = 0.3;
            footL.parent = legL;
            footL.material = pantsMaterial;

            const footR = BABYLON.MeshBuilder.CreateSphere("footR", { diameter: 0.7, slice: 0.5 }, scene);
            footR.position.y = -0.3;
            footR.position.z = 0.05;
            footR.scaling.y = 0.3;
            footR.parent = legR;
            footR.material = pantsMaterial;

            // --- SKIRT GEOMETRY (Hidden by default, used for dress style) ---
            skirtMesh = BABYLON.MeshBuilder.CreateCylinder("skirt", {
                diameterTop: 1.1,
                diameterBottom: 1.8,
                height: 1.4,
                tessellation: 12,
                subdivisions: 4
            }, scene);

            skirtMesh.convertToFlatShadedMesh();
            skirtMesh.position.y = 1.6;
            skirtMesh.material = clothesMaterial;
            skirtMesh.parent = root;
            skirtMesh.isVisible = false;
            shadowGenerator.addShadowCaster(skirtMesh);


            // Initial Draw
            updateFace();
            updateHair();
            updateColors();

            return scene;
        };

        // --- DRAWING LOGIC (Copied from Shell POC) ---
        function updateFace() {
            if (!faceTexture) return;
            const ctx = faceTexture.getContext();
            const w = 1024; const h = 1024;

            ctx.fillStyle = currentConfig.skinColor;
            ctx.fillRect(0, 0, w, h);
            headMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.skinColor);
            skinMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.skinColor);

            const centerX = w / 2;
            const eyeY = h * 0.45;
            const mouthY = h * 0.58;
            const eyeOffset = w * 0.12;

            // Simple Face Logic
            if (currentConfig.hasBlush) {
                ctx.fillStyle = "rgba(200, 50, 50, 0.15)";
                ctx.beginPath();
                ctx.arc(centerX - eyeOffset - 20, eyeY + 60, 45, 0, Math.PI * 2);
                ctx.arc(centerX + eyeOffset + 20, eyeY + 60, 45, 0, Math.PI * 2);
                ctx.fill();
            }

            // Eyes & Glasses
            ctx.fillStyle = "#222";
            ctx.strokeStyle = "#222";
            ctx.lineWidth = 15;

            if (currentConfig.eyeStyle === 'oval') {
                ctx.beginPath();
                ctx.ellipse(centerX - eyeOffset, eyeY, 25, 45, 0, 0, Math.PI * 2);
                ctx.ellipse(centerX + eyeOffset, eyeY, 25, 45, 0, 0, Math.PI * 2);
                ctx.fill();
            } else {
                ctx.beginPath();
                ctx.arc(centerX - eyeOffset, eyeY, 25, 0, Math.PI * 2);
                ctx.arc(centerX + eyeOffset, eyeY, 25, 0, Math.PI * 2);
                ctx.fill();
            }

            if (currentConfig.hasGlasses) {
                ctx.fillStyle = "rgba(200, 240, 255, 0.4)";
                ctx.strokeStyle = "#111";
                ctx.lineWidth = 8;
                let gx = 55; let gy = 40;
                ctx.beginPath();
                ctx.roundRect(centerX - eyeOffset - gx / 2 - 10, eyeY - gy / 2, gx + 20, gy + 10, 20);
                ctx.fill(); ctx.stroke();
                ctx.beginPath();
                ctx.roundRect(centerX + eyeOffset - gx / 2 - 10, eyeY - gy / 2, gx + 20, gy + 10, 20);
                ctx.fill(); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(centerX - eyeOffset + 25, eyeY); ctx.lineTo(centerX + eyeOffset - 25, eyeY); ctx.stroke();
            }

            // Mouth
            ctx.strokeStyle = "#333";
            ctx.lineWidth = 12;

            if (currentConfig.mouthStyle === 'smirk') {
                ctx.beginPath();
                ctx.moveTo(centerX - 30, mouthY);
                ctx.quadraticCurveTo(centerX + 10, mouthY + 15, centerX + 40, mouthY - 10);
                ctx.stroke();
            } else if (currentConfig.mouthStyle === 'happy') {
                ctx.beginPath();
                ctx.arc(centerX, mouthY - 10, 50, 0.2, Math.PI - 0.2);
                ctx.stroke();
            } else {
                ctx.beginPath();
                ctx.moveTo(centerX - 30, mouthY);
                ctx.lineTo(centerX + 30, mouthY);
                ctx.stroke();
            }

            faceTexture.update();
        }

        function updateHair() {
            if (!hairOpacityTexture) return;
            const ctx = hairOpacityTexture.getContext();
            const w = 1024; const h = 1024;
            const centerX = w / 2;

            if (currentConfig.hairStyle === 'none') {
                ctx.clearRect(0, 0, w, h);
                hairOpacityTexture.update();
                hairShell.isVisible = false;
                if (hairBun) hairBun.isVisible = false;
                return;
            } else {
                hairShell.isVisible = true;
                // Bun logic: Only for 'bangs' style for now (Secretary)
                if (hairBun) hairBun.isVisible = (currentConfig.hairStyle === 'bangs' || currentConfig.hairStyle === 'bun');
            }

            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, w, h);
            ctx.globalCompositeOperation = "destination-out";
            ctx.fillStyle = "black";

            // Cutouts
            ctx.beginPath();

            if (currentConfig.hairStyle === 'bangs') {
                // Structured Bangs
                ctx.moveTo(centerX, h * 0.35);
                ctx.bezierCurveTo(w * 0.3, h * 0.32, w * 0.2, h * 0.4, w * 0.2, h * 0.6);
                ctx.lineTo(w * 0.2, h); ctx.lineTo(w * 0.8, h);
                ctx.lineTo(w * 0.8, h * 0.6);
                ctx.bezierCurveTo(w * 0.8, h * 0.4, w * 0.7, h * 0.32, centerX, h * 0.35);
                ctx.fill();
            } else if (currentConfig.hairStyle === 'bob') {
                // Boxy Cutout
                ctx.moveTo(w * 0.2, h * 0.32);
                ctx.quadraticCurveTo(centerX, h * 0.35, w * 0.8, h * 0.32);
                ctx.lineTo(w * 0.8, h);
                ctx.lineTo(w * 0.2, h);
                ctx.closePath();
                ctx.fill();
            } else if (currentConfig.hairStyle === 'sidepart') {
                // Side Part
                ctx.moveTo(w * 0.15, h * 0.3);
                ctx.bezierCurveTo(w * 0.3, h * 0.25, w * 0.6, h * 0.45, w * 0.85, h * 0.35);
                ctx.lineTo(w * 0.85, h);
                ctx.lineTo(w * 0.15, h);
                ctx.closePath();
                ctx.fill();
            } else if (currentConfig.hairStyle === 'short') {
                // Short / Male Cut
                ctx.moveTo(w * 0.2, h * 0.4);
                ctx.quadraticCurveTo(centerX, h * 0.35, w * 0.8, h * 0.4); // Higher hairline
                ctx.lineTo(w * 0.8, h * 0.6); // Sideburn area
                ctx.quadraticCurveTo(w * 0.8, h * 0.5, w * 0.8, h * 0.4);
                // Just a simple recession
                ctx.lineTo(w * 0.8, h);
                ctx.lineTo(w * 0.2, h);
                ctx.closePath();
                ctx.fill();
            } else if (currentConfig.hairStyle === 'helmet') {
                // Full Helmet (No cutout except maybe face)
                ctx.beginPath();
                ctx.arc(centerX, h * 0.45, 180, 0, Math.PI * 2); // Face hole
                ctx.fill();
                // We actually want the inverse for helmet usually, but here we paint Black to cut. 
                // Let's just create a visor slit
            }

            hairMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.hairColor);
            ctx.globalCompositeOperation = "source-over";
            hairOpacityTexture.update();
        }

        function updateColors() {
            clothesMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.clothesColor);
            pantsMaterial.diffuseColor = BABYLON.Color3.FromHexString(currentConfig.pantsColor);
        }

        // --- UI BINDINGS ---
        function update() {
            updateFace();
            updateHair();
            updateColors();

            // Toggle Skirt
            if (skirtMesh) {
                if (currentConfig.hairStyle === 'bangs' || currentConfig.hairStyle === 'bob') {
                    // Female / Dress
                    skirtMesh.isVisible = true;
                    if (legL) legL.material = skinMaterial;
                    if (legR) legR.material = skinMaterial;
                } else {
                    // Male / Pants
                    skirtMesh.isVisible = false;
                    if (legL) legL.material = pantsMaterial;
                    if (legR) legR.material = pantsMaterial;
                }
            }
        }

        document.getElementById("skinColor").addEventListener("input", (e) => { currentConfig.skinColor = e.target.value; update(); });
        document.getElementById("hairColor").addEventListener("input", (e) => { currentConfig.hairColor = e.target.value; update(); });
        document.getElementById("hairStyle").addEventListener("change", (e) => { currentConfig.hairStyle = e.target.value; update(); });

        document.getElementById("clothesColor").addEventListener("input", (e) => { currentConfig.clothesColor = e.target.value; update(); });
        document.getElementById("pantsColor").addEventListener("input", (e) => { currentConfig.pantsColor = e.target.value; update(); });

        document.getElementById("expression").addEventListener("change", (e) => {
            const map = { 'neutral': 'line', 'happy': 'happy', 'smirk': 'smirk' };
            currentConfig.mouthStyle = map[e.target.value] || 'line';
            update();
        });
        document.getElementById("eyeStyle").addEventListener("change", (e) => { currentConfig.eyeStyle = e.target.value; update(); });
        document.getElementById("hasGlasses").addEventListener("change", (e) => { currentConfig.hasGlasses = e.target.checked; update(); });


        function setSecretary() {
            currentConfig.hairStyle = "bangs";
            currentConfig.hairColor = "#cc3300";
            currentConfig.skinColor = "#ffdbac";
            currentConfig.clothesColor = "#ffffff";
            currentConfig.pantsColor = "#222222";
            currentConfig.mouthStyle = "smirk";
            currentConfig.eyeStyle = "oval";
            currentConfig.hasGlasses = true;

            // Update UI
            updateUI();
            update();
        }

        function setExecutive() {
            currentConfig.hairStyle = "sidepart";
            currentConfig.hairColor = "#444444"; // Grey/Silver
            currentConfig.skinColor = "#e0ac69";
            currentConfig.clothesColor = "#003366"; // Navy Suit
            currentConfig.pantsColor = "#003366";
            currentConfig.mouthStyle = "neutral";
            currentConfig.eyeStyle = "dot";
            currentConfig.hasGlasses = true;
            updateUI(); update();
        }

        function setConstruction() {
            currentConfig.hairStyle = "short";
            currentConfig.hairColor = "#333333";
            currentConfig.skinColor = "#c68642";
            currentConfig.clothesColor = "#ff6600"; // Safety Orange
            currentConfig.pantsColor = "#3366cc";   // Jeans
            currentConfig.mouthStyle = "smirk";
            currentConfig.eyeStyle = "dot";
            currentConfig.hasGlasses = false;
            updateUI(); update();
        }

        function setAthlete() {
            currentConfig.hairStyle = "short"; // Or 'helmet' if we implemented it fully
            currentConfig.hairColor = "#111111";
            currentConfig.skinColor = "#8d5524";
            currentConfig.clothesColor = "#cc0000"; // Jersey
            currentConfig.pantsColor = "#ffffff";   // White pants
            currentConfig.mouthStyle = "happy";
            currentConfig.eyeStyle = "oval";
            currentConfig.hasGlasses = false;
            updateUI(); update();
        }

        function updateUI() {
            document.getElementById("clothesColor").value = currentConfig.clothesColor;
            document.getElementById("pantsColor").value = currentConfig.pantsColor;
            document.getElementById("hairColor").value = currentConfig.hairColor;
            document.getElementById("skinColor").value = currentConfig.skinColor;
            document.getElementById("hairStyle").value = currentConfig.hairStyle;
            document.getElementById("expression").value = currentConfig.mouthStyle;
            document.getElementById("eyeStyle").value = currentConfig.eyeStyle;
            document.getElementById("hasGlasses").checked = currentConfig.hasGlasses;
        }

        function randomize() {
            const clothes = ["#336699", "#993333", "#339933", "#ffffff", "#333333", "#ffcc00"];
            const pants = ["#111111", "#444444", "#223344", "#663322", "#ffffff"];
            const hairs = ["bob", "sidepart", "bangs", "short", "none"];
            const skins = ["#ffdbac", "#f1c27d", "#e0ac69", "#8d5524", "#c68642"];
            const mouths = ["neutral", "happy", "smirk"];
            const eyes = ["oval", "dot"];

            currentConfig.clothesColor = clothes[Math.floor(Math.random() * clothes.length)];
            currentConfig.pantsColor = pants[Math.floor(Math.random() * pants.length)];
            currentConfig.hairStyle = hairs[Math.floor(Math.random() * hairs.length)];
            currentConfig.skinColor = skins[Math.floor(Math.random() * skins.length)];
            currentConfig.hairColor = "#" + Math.floor(Math.random() * 16777215).toString(16);

            currentConfig.mouthStyle = mouths[Math.floor(Math.random() * mouths.length)];
            currentConfig.eyeStyle = eyes[Math.floor(Math.random() * eyes.length)];
            currentConfig.hasGlasses = Math.random() > 0.7; // 30% chance

            updateUI();
            update();
        }

        const scene = createScene();
        engine.runRenderLoop(() => scene.render());
        window.addEventListener("resize", () => engine.resize());

    </script>
</body>

</html>