@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime

<div class="renderer-container" style="width: 100%; height: 100%; position: relative;">
    <iframe id="mctwin-renderer" 
            srcdoc="@RendererHtml"
            style="width: 100%; height: 100%; border: none;"
            @onload="OnRendererLoaded">
    </iframe>
</div>

@code {
    [Parameter] public EventCallback OnReady { get; set; }

    private string RendererHtml => @"
<!DOCTYPE html>
<html>
<head>
    <meta charset=""utf-8"" />
    <title>MCTwin World</title>
    <!-- Minimal dependencies only -->
    <script src=""https://cdn.babylonjs.com/babylon.js""></script>
    <script src=""https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js""></script>
    <style>
        body { margin: 0; overflow: hidden; background: #333; }
        canvas { width: 100%; height: 100%; }
        #loading { position: absolute; top: 10px; left: 10px; color: white; }
        #debugConsole {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: 300px;
            height: 150px;
            background: rgba(0, 0, 0, 0.7);
            color: #00FF00;
            font-family: 'Consolas', monospace;
            font-size: 10px;
            overflow-y: auto;
            padding: 5px;
            pointer-events: none;
            border: 1px solid #333;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <div id=""loading"">Loading World Engine...</div>
    <div id=""debugConsole""></div>
    <canvas id=""renderCanvas""></canvas>
    <script src=""world.js""></script>
    <script>
        document.getElementById(""loading"").innerText = ""Engine Scripts Loaded."";
    </script>
</body>
</html>";

    private async Task OnRendererLoaded()
    {
        // Give the renderer a moment to initialize its own scene
        await Task.Delay(500);
        await OnReady.InvokeAsync();
    }
}
